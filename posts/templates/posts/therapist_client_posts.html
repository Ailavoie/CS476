{% extends "base.html" %}

{% block title %}
  Mindlink - {{ client.first_name }}'s Posts
{% endblock %}

{% block extra_css %}
  {% load static %}
  <link rel="stylesheet" href="{% static 'posts/css/style.css' %}">
{% endblock %}

{% block content %}
<section class="my-posts">
  <div class="container">
    <div class="section-title">
      <h2>Posts from {{ client.first_name }} {{ client.last_name }}</h2>
      <p>Review and leave your comments on your client‚Äôs entries.</p>
    </div>
    <div class="post-actions-left">
      <a href="{% url 'posts:therapist_clients' %}" class="btn-secondary">‚Üê Back to Client List</a>
    </div>

    <div class="posts-container">
      {% if posts %}
        <ul class="posts-list">
          {% for post in posts %}
            <li class="post-item">
              <div class="post-date">
                <i class="fas fa-calendar-alt"></i>
                <span><em>Created at:</em> {{ post.created_at|date:"F j, Y, g:i a" }}</span>
              </div>

              <div class="post-text">
                {% if post.post_type == 'daily' %}
                    <p><strong>Daily Post Details:</strong></p>
                    <p>{{ post.text|safe }}</p>
                {% elif post.post_type == 'mood' %}
                    <p><strong>Mood Post Details:</strong></p>
                    <ul>
                        <li>Mood: {{ post.mood_emoji }}</li>
                        <li>Energy Level: {{ post.energy_level }}</li>
                        <li>Worked Out: {% if post.worked_out %}Yes{% else %}No{% endif %}</li>
                        <li>Trigger: {{ post.mood_trigger }}</li>
                    </ul>
                {% endif %}
              </div>

              {% if post.comments.all %}
                <div class="existing-comments">
                  <strong>Therapist Comments:</strong>
                  <ul>
                    {% for comment in post.comments.all %}
                      <li>
                        <p>{{ comment.text }}</p>
                        <small><em>By {{ comment.therapist.user.first_name }} {{ comment.therapist.user.last_name }} on {{ comment.created_at|date:"F j, Y, g:i a" }}</em></small>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}

              <form method="post" action="{% url 'posts:add_comment' post_id=post.id post_type=post.post_type|add:'post' %}" class="comment-form">
                {% csrf_token %}
                <div class="form-container">
                  <label for="commentary-{{ post.id }}"><strong>Your Comment:</strong></label>
                  <textarea id="commentary-{{ post.id }}" name="commentary" rows="3" placeholder="Leave a comment..."></textarea>
                  <div class="post-actions">
                    <button type="submit" class="btn-sm btn-edit">üíæ Save Comment</button>
                  </div>
                </div>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="no-posts">No posts yet for this client.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
