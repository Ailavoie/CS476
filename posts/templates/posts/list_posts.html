{% extends "base.html" %}

{% block title %}
  Mindlink - My Posts
{% endblock %}

{% block extra_css %}
  {% load static %}
  <link rel="stylesheet" href="{% static 'posts/css/style.css' %}">
{% endblock %}

{% block content %}
<section class="my-posts">
  <div class="container">
    <div class="section-title">
      <h2>My Posts</h2>
      <p>Manage and view your journal entries.</p>
    </div>

    <div class="posts-container">
      <a href="{% url 'posts:create_post' %}" class="btn btn-primary mb-20">
        <i class="fas fa-plus"></i> New Post
      </a>

      {% if posts %}
        <ul class="posts-list">
          {% for post in posts %}
            <li class="post-item" data-post-id="{{ post.pk }}">  <!-- AÃ±adir data-post-id al li -->
              <div class="post-date">
                <i class="far fa-clock"></i> {{ post.created_at|date:"Y-m-d H:i" }}
              </div>
              <div class="post-text">
                {{ post.text|linebreaks }}
              </div>

              {% if post.commentary %}
                <div class="therapist-comment">
                  <i class="fas fa-comment-dots"></i>
                  <strong>Therapist comment:</strong> {{ post.commentary }}
                </div>
              {% endif %}

              <div class="post-actions">
                <a href="{% url 'posts:edit_post' post.pk %}" class="btn btn-sm btn-edit">
                  <i class="fas fa-edit"></i> Edit
                </a>
                <button type="button" 
                        class="btn btn-sm btn-delete" 
                        data-micromodal-trigger="deleteModal" 
                        data-delete-url="{% url 'posts:delete_post' post.pk %}">
                  <i class="fas fa-trash-alt"></i> Delete
                </button>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="no-posts">No posts yet.</p>
      {% endif %}

      <!-- Modal HTML -->
      <div class="modal micromodal-slide" id="deleteModal" aria-hidden="true">
        <div class="modal__overlay" tabindex="-1" data-micromodal-close>
          <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="deleteModal-title">
            <header class="modal__header">
              <h2 class="modal__title" id="deleteModal-title">
                Delete Post
              </h2>
              <button class="modal__close" aria-label="Close modal" data-micromodal-close></button>
            </header>
            <main class="modal__content" id="deleteModal-content">
              <p>Are you sure you want to delete this journal entry?</p>
              <p>This action cannot be undone.</p>
            </main>
            <footer class="modal__footer">
              <button class="modal__btn modal__btn-danger" id="confirmDelete">Yes, delete</button>
              <button class="modal__btn" data-micromodal-close aria-label="Close this dialog window">Cancel</button>
            </footer>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
  {% load static %}
  <script src="{% static 'posts/js/posts.js' %}"></script>  <!-- Enlaza tu archivo JS -->
{% endblock %}