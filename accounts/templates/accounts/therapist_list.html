{% extends "base.html" %}
{% load static %}
{% load tz %}

{% block title %}Find Your Therapist - Mindlink{% endblock %}
{% block description %}Explore our list of certified therapists and connect with the right professional for your wellbeing.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/style.css' %}">
{% endblock %}

{% block content %}
<section class="therapists-section">
    <div class="container">
        <div class="section-title">
            <h2>Connect with Your Therapist</h2>
            <p>Please select your connection method below to begin working with a professional.</p>
        </div>

        <div class="connection-methods-layout" style="margin-bottom: 20px;">
            
            {% if messages %}
                <div class="method-panel messaging-instructions" 
                     style="margin-bottom: 20px; padding: 20px; border-radius: 10px; border: none; 
                            background-color: #007bff; color: white; text-align: center; font-weight: bold;">
                    
                    {% for message in messages %}
                        <div role="alert" style="margin: 0; padding: 5px 0;">
                            <i class="fas fa-info-circle"></i> {{ message }}
                        </div>
                    {% endfor %}

                </div>
            {% endif %}

            <div class="method-panel code-connect" style="padding: 25px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #007bff;">
                <h3><i class="fas fa-lock"></i> 1. Already have a therapist?</h3>
                <p>If your therapist has provided you with a connection code, use this option for an instant, verified connection.</p>
                <a href="{% url 'accounts:send_connection_request' %}" class="btn btn-lg btn-primary w-100">
                    <i class="fas fa-key"></i> Enter Access Code
                </a>
            </div>

        </div>
        
        <hr>

        <div class="browse-therapists-section" style="margin-top: 40px;">
            <h3>2. Browse Available Therapists</h3>
            <p>Review the profiles below and click 'Connect' to send a formal connection request.</p>

            <div class="therapist-grid">
                {% for therapist in therapists %}
                    <div class="therapist-card">
                        <div class="therapist-avatar">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="therapist-info">
                            <h3>{{ therapist.first_name }} {{ therapist.last_name }}</h3>
                            <p class="specialty">{{ therapist.specialty|default:"General Therapist" }}</p>
                            <p class="location">
                                <i class="fas fa-map-marker-alt"></i>
                                {{ therapist.country }}, {{ therapist.province }}
                            </p>
                            {% if therapist.phone_number %}
                                <p class="phone">
                                    <i class="fas fa-phone-alt"></i>
                                    {{ therapist.phone_number }}
                                </p>
                            {% endif %}
                            {% if therapist.age %}
                                <p class="age">
                                    <i class="fas fa-birthday-cake"></i>
                                    {{ therapist.age }} years old
                                </p>
                            {% endif %}
                        </div>
                        
                        <div class="card-action-bar">
                            {% if therapist.is_connected %}
                                <button type="button" class="btn btn-danger btn-sm" disabled>
                                    <i class="fas fa-unlink"></i> Disconnect
                                </button>
                            {% elif therapist.has_pending_request %}
                                <button type="button" class="btn btn-warning btn-sm" disabled>
                                    <i class="fas fa-clock"></i> Request Sent
                                </button>
                            {% else %}
                                <form method="post" action="{% url 'accounts:send_direct_request' therapist.pk %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-primary btn-sm">
                                        <i class="fas fa-paper-plane"></i> Connect
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% empty %}
                    <p class="no-therapists">No therapists available at the moment. Please check back later.</p>
                {% endfor %}
            </div>
        </div>
        
    </div>
</section>
{% endblock %}